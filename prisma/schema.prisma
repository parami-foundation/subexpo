datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model ChainBlock {
  blockNum        Int              @id
  blockAt         Int
  blockHash       String           @unique
  parentHash      String
  stateRoot       String
  extrinsicsRoot  String
  logs            ChainLog[]
  extrinsics      ChainExtrinsic[]
  extrinsicsCount Int
  events          ChainEvent[]
  eventCount      Int
  specVersion     Int
  validator       String
  finalized       Boolean          @default(false)
}

model ChainEvent {
  eventId        String          @id
  blockNum       Int
  blockAt        Int
  extrinsicIdx   Int
  eventIdx       Int
  section        String
  method         String
  data           Json
  extrinsicHash  String
  ChainBlock     ChainBlock?     @relation(fields: [blockNum], references: [blockNum])
  ChainExtrinsic ChainExtrinsic? @relation(fields: [extrinsicHash], references: [extrinsicHash])
}

model ChainExtrinsic {
  extrinsicId     String       @id
  blockNum        Int
  blockAt         Int
  method          String
  section         String
  args            Json
  events          ChainEvent[]
  accountId       String?
  signature       String?
  nonce           Int
  extrinsicHash   String       @unique
  isSigned        Boolean
  success         Boolean
  fee             BigInt
  tip             BigInt
  versionInfo     Int
  extrinsicLength Int
  ChainBlock      ChainBlock?  @relation(fields: [blockNum], references: [blockNum])
}

model ChainLog {
  logId      String      @id
  blockNum   Int
  logType    String
  data       Json
  finalized  Boolean     @default(false)
  ChainBlock ChainBlock? @relation(fields: [blockNum], references: [blockNum])
}

model ChainVersion {
  specVersion Int    @id
  modules     String @db.Text
  rawData     Json
}
